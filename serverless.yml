service: serverless-wiki-crawler 

provider:
  name: aws
  runtime: python3.6
  memorySize: 128
  logRetentionInDays: 30
  stage: ${opt:stage, 'dev'}
  region: eu-west-1
  environment:
    S3_CONTENT_TYPE: application/json
  # you can add statements to the Lambda function's IAM Role here
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "s3:*"
      Resource: 
        - "arn:aws:s3:::${self:custom.buckets.wikiBucketName}/*"

plugins:
   - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: non-linux
  bucketPrefix: ${self:service}-${self:provider.stage}
  buckets:
    wikiBucketName: ${self:custom.bucketPrefix}-wiki-crawler 

# here the functions go
functions:
  wiki:
    handler: handler.wiki_crawler
    environment:
      S3_BUCKET_NAME: ${self:custom.buckets.wikiBucketName}
    events:
      - schedule: 
          rate: rate(1 minute)
          enabled: true
          input:
            lang: pl
        
# you can add CloudFormation resource templates here
resources:
 Resources:
   WikiBucket:
     Type: AWS::S3::Bucket
     Properties:
       BucketName: ${self:custom.buckets.wikiBucketName}